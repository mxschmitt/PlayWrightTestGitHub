on: 
  push:
  workflow_dispatch:

jobs:
   
  test:
    runs-on: windows-latest

    steps:
    
    - uses: actions/checkout@v3

    - name: Cache Playwright Browser
      uses: actions/cache@v3
      with:
        path: ~\AppData\Local\ms-playwright
        key: playwright-browser

#    - name: Install Playwright Chrome
#      run: npx playwright install-deps chromium

#    - name: Add MSBUILD to PATH
#      uses: microsoft/setup-msbuild@v1.0.2
      
#    - name: Restore NuGet Packages
#      shell: pwsh
#      run: msbuild -t:restore -p:RestorePackagesConfig=true .\src\Playwright.sln

#    - name: Build Site
#      run: msbuild .\src\Playwright.sln /p:Configuration=Debug
      
    - name: Setup VSTest Path
      uses: darenm/Setup-VSTest@v1.2

#    - uses: mxschmitt/action-tmate@v3

    - name: Install playwright
      run: |
        $playwrightInstaller = Get-Childitem -Path .\src\XUnitTestProject\ -Recurse playwright.ps1
        & $playwrightInstaller install

    - name: Run Unit Tests
      run: |
        $testDll = Get-ChildItem -Recurse .\XUnitTestProject.dll
        vstest.console.exe $testDll
